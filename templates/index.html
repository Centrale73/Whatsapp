<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Book an Appointment</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
    body { background: #0f0f0f; display: flex; justify-content: center; align-items: center; height: 100vh; }
    #chat-container {
      width: 420px; height: 620px; background: #1a1a1a;
      border-radius: 16px; display: flex; flex-direction: column;
      box-shadow: 0 8px 40px rgba(0,0,0,0.6); overflow: hidden;
    }
    #chat-header {
      background: #075e54; padding: 16px 20px; color: white;
      font-weight: 700; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;
    }
    #chat-header::before { content: "ðŸ“…"; font-size: 1.3rem; }
    #messages {
      flex: 1; overflow-y: auto; padding: 16px;
      display: flex; flex-direction: column; gap: 10px;
    }
    .msg { max-width: 80%; padding: 10px 14px; border-radius: 12px; line-height: 1.5; font-size: 0.9rem; }
    .msg.bot  { background: #2a2a2a; color: #e0e0e0; align-self: flex-start; border-bottom-left-radius: 4px; }
    .msg.user { background: #25d366; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
    .typing   { color: #888; font-style: italic; }
    #input-row { display: flex; padding: 12px; gap: 8px; border-top: 1px solid #2a2a2a; }
    #user-input {
      flex: 1; background: #2a2a2a; border: none; border-radius: 24px;
      padding: 10px 16px; color: #fff; font-size: 0.9rem; outline: none;
    }
    #send-btn {
      background: #25d366; border: none; border-radius: 50%;
      width: 42px; height: 42px; cursor: pointer; font-size: 1.1rem;
      display: flex; align-items: center; justify-content: center;
    }
    #send-btn:hover { background: #1ebe57; }
    #messages::-webkit-scrollbar { width: 4px; }
    #messages::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
  </style>
</head>
<body>
<div id="chat-container">
  <div id="chat-header">Book an Appointment</div>
  <div id="messages"></div>
  <div id="input-row">
    <input id="user-input" type="text" placeholder="Type a message..." autocomplete="off"/>
    <button id="send-btn">&#10148;</button>
  </div>
</div>

<script>
  const messagesEl = document.getElementById('messages');
  const input = document.getElementById('user-input');
  const sendBtn = document.getElementById('send-btn');
  let sessionId = localStorage.getItem('appt_session') || null;

  function addMsg(text, role) {
    const div = document.createElement('div');
    div.className = `msg ${role}`;
    div.textContent = text;
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
    return div;
  }

  async function sendMessage(text) {
    if (!text.trim()) return;
    input.value = '';
    addMsg(text, 'user');
    const typingEl = addMsg('...', 'bot typing');
    try {
      const res = await fetch('/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: text, session_id: sessionId })
      });
      const data = await res.json();
      sessionId = data.session_id;
      localStorage.setItem('appt_session', sessionId);
      typingEl.remove();
      addMsg(data.response, 'bot');
    } catch (err) {
      typingEl.remove();
      addMsg('Connection error. Please try again.', 'bot');
    }
  }

  sendBtn.addEventListener('click', () => sendMessage(input.value));
  input.addEventListener('keydown', e => { if (e.key === 'Enter') sendMessage(input.value); });

  window.onload = () => sendMessage('hi');
</script>
</body>
</html>
